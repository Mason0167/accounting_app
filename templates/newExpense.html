<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ trip_name|title }} Expenses</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">

</head>

<body>
    <div class="container">
        <h1>{{ trip_name|title }} Expenses</h1>

        <form method="POST" class="form-box">

            <!-- Category -->
            <label>Category:</label>
            <select name="category" class="input-field">
                {% for category in categories_list %}
                <option value="{{ category[1] }}"
                    {% if category[1] == entered_category|default('') %} selected {% endif %}>
                    {{ category[1]|title }}
                </option>                
                {% endfor %}
            </select>

            <!-- Payment Method -->
            <label>Payment Method:</label>
            <div class="payment-methods">
                {% for paymentMethod in paymentMethods_list %}
                <label class="payment-option">
                    <input type="radio" name="payment_method" value="{{ paymentMethod[1] }}"
                        {% if paymentMethod[1] == entered_paymentMethod|default('') %} checked {% endif %}>
                    <span>{{ paymentMethod[1]|title }}</span>
                </label>
                {% endfor %}
            </div>

            <!-- Item & Amount (side by side if screen allows) -->
            <div class="item-amount-group">
                <div class="field">
                    <label>Item:</label>
                    <input type="text" name="item" class="input-field"
                        value="{{ entered_item|default('') }}">
                </div>
                <div class="field">
                    <label>Amount:</label>
                    <input type="number" step="0.01" name="amount" class="input-field"
                        value="{{ entered_amount_str|default('') }}">
                </div>
            </div>

            <!-- Currency -->
            <label>Currency:</label>
            <select name="currency" class="input-field">
                {% for currency in currencies_list %}
                <option name="currency" value="{{ currency[1] }}"
                    {% if currency[1] == entered_currency|default('') %} selected {% endif %}>
                    {{ currency[2] }} - {{ currency[1] }}
                </option>
                {% endfor %}
            </select>

            <!-- Submit -->
            <button type="submit" class="btn btn-submit">Add</button>
        </form>

        <!-- 支出列表 -->
        {% if grouped_expenses %}
            {% for cat, expenses in grouped_expenses.items() %}
                <h3>{{ cat|capitalize }}</h3>
                <ul class="expense-list">
                    {% for e in expenses %}
                        <li class="expense-row">
                            <span class="expense-text">
                                {{ e.item|capitalize }} : {{ e.code }} {{ e.symbol }}{{ "%.2f"|format(e.amount) }} 
                            </span>

                            <button type="button"
                                    class="btn btn-delete-expense"
                                    data-id="{{ e.id }}"
                                    data-item="{{ e.item }}">
                                Delete
                            </button>
                        </li>
                    {% endfor %}
                </ul>
            {% endfor %}
        {% else %}
            <p>No Expense for this trip.</p>
        {% endif %}

        <a href="{{ url_for('index') }}">
            <button type="button" class="btn btn-large">Home</button>
        </a>

        <a href="{{ url_for('tripSelection') }}">
            <button type="button" class="btn btn-large">Trips</button>
        </a>
    </div>


    <!-- Flexible Modal for Delete / Errors -->
    <div id="flexModal" class="modal">
        <div class="modal-content">
            <p id="modal-text"></p>
            <form id="modalForm" method="POST" style="display:none;">
                <button type="submit" class="btn btn-confirm-delete" id="modalConfirmBtn">Yes, Delete</button>
                <button type="button" class="btn" onclick="closeModal()">Cancel</button>
            </form>
            <button type="button" class="btn" id="modalOkBtn" style="display:none;" onclick="closeModal()">OK</button>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/modal.js') }}"></script>
    <script>
        // If there is an error message from Flask, show it on page load
        document.addEventListener('DOMContentLoaded', function () {
            {% if modal_message %}
            // |escape converts them to safe HTML entities.
            openModal({type: 'error', text: "{{ modal_message|escape }}"}); 
            {% endif %}
        });
    </script>
</body>

</html>