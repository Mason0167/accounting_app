<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Expenses</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
        <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">

</head>

<body>
    <div class="container">
        <h1>All Expenses</h1>

        <!-- Trip 篩選下拉 -->
        <form method="GET" class="form-box">
            <label>
                Select Trip:
                <select name="trip_id" onchange="this.form.submit()">
                    <option value="">All Trips</option>
                    {% for trip in trips %}
                        <option value="{{ trip.id }}" {% if selected_trip == trip.id %}selected{% endif %}>
                        {{ trip.trip_name }}
                        </option>
                    {% endfor %}
                </select>
            </label>
        </form>

        <!-- 支出列表 -->
        {% if grouped_expenses %}
            {% for cat, expenses in grouped_expenses.items() %}
                <h3>{{ cat|capitalize }}</h3>
                <ul class="expense-list">
                    {% for e in expenses %}
                        <li class="expense-row">
                            <span class="expense-text">
                                {{ e.item|capitalize }} : {{ e.code }} {{ e.symbol }}{{ "%.2f"|format(e.amount) }} 
                            </span>

                            <button type="button"
                                    class="btn btn-delete-expense"
                                    data-id="{{ e.id }}"
                                    data-item="{{ e.item }}">
                                Delete
                            </button>
                        </li>
                    {% endfor %}
                </ul>
            {% endfor %}
        {% else %}
            <p>No Expense for this trip.</p>
        {% endif %}

        <a href="{{ url_for('index') }}">
            <button type="button" class="btn btn-large">Back to Home</button>
        </a>

        <a href="{{ url_for('tripSelection') }}">
            <button type="button" class="btn btn-large">Back to Trips</button>
        </a>
    </div>

    <!-- Flexible Modal for Delete / Errors -->
    <div id="flexModal" class="modal">
        <div class="modal-content">
            <p id="modal-text"></p>
            <form id="modalForm" method="POST" style="display:none;">
                <button type="submit" class="btn btn-confirm-delete" id="modalConfirmBtn">Yes, Delete</button>
                <button type="button" class="btn" onclick="closeModal()">Cancel</button>
            </form>
            <button type="button" class="btn" id="modalOkBtn" style="display:none;" onclick="closeModal()">OK</button>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/modal.js') }}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            {% if modal_message %}
            // |escape converts them to safe HTML entities.
            openModal({type: 'error', text: "{{ modal_message|escape }}"}); 
            {% endif %}
        });
    </script>
</body>

</html>